"use strict";var _createClass=function(){function a(b,c){for(var f,d=0;d<c.length;d++)f=c[d],f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var animateNotifiers=function(){function a(b){_classCallCheck(this,a),this.container=b}return _createClass(a,[{key:"show",value:function show(b){var c=document.getElementById(this.container);b.forEach(function(d,f){var g=document.createElement("div"),h=d.split("/"),j=document.createTextNode(h[1]);g.setAttribute("id","notifier-"+h[0]),g.setAttribute("class","notifier show"),g.appendChild(j),g.style.animationDelay=f/5+"s",c.appendChild(g)})}},{key:"success",value:function success(b){var c=document.getElementById(this.container),d=null;b.forEach(function(f){d=f.split("/");var g=document.getElementById("notifier-"+d[0]);g.classList.add("success"),setTimeout(function(){g.remove()},5e3)})}}]),a}();function main(){$("#exampleModal").after("<div id='box-notifier' class='notifiers'></div>")}function makeid(){for(var a="",b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;12>c;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a}function addCategory(){var a=$(this),b=a.siblings("span"),c=b[0],d=b[1];a.css("display","none"),c.style.display="inline-block",c.focus(),withDinamicTable()}function withDinamicTable(){var a=$("#wrapperMain").width(),b=+$("#dinamicTable").width()+2e3;$("#div1").width(b),$("#wrapper2").width(a),$("#wrapper1").width(a),1100<$("#dinamicTable").width()?$("#div1").css("display","block"):$("#div1").css("display","none")}function ajax(a,b,c,d){$.ajax({url:a,type:"POST",dataType:"json",data:b,beforeSend:function beforeSend(){},success:function success(f){c(f)},error:function error(f,g,h){d(f,g,h)},complete:function complete(){}})}function keyDownPressCategory(a){var b=a.keyCode||a.which,c=$(this),d=c.parent().attr("data-category"),f=$(".col-add."+d+".content-subcategory").length;if(13===b&&1===f)return!1;if(13===b&&0===f){if(""===c[0].textContent){var g=c.parent().attr("data-text"),h=c.parent().attr("data-id");return $("#modalDinamicTable").css("display","block"),$("#modalDinamicTable .modal-content").addClass("slideDown"),$("#modalDinamicTable .modal-content .message-title").text("Eliminaci\xF3n de categoria"),$("#modalDinamicTable .modal-content .message").text("Desea eliminar la categoria ").append("<b>"+g+"?</b>"),objDelete.el=d,objDelete.id=h,objDelete.text=g,objDelete.tipo="category",objDelete.url="category_delete",!1}c.attr("contenteditable","false");var j=baseUrl+"category_update/",k={category:c[0].textContent,id:c.parent().attr("data-id")},l=makeid(),m=[l+"/"+c[0].textContent];AnimateNotifiers.show(m),ajax(j,k,function(o){var q=o.data;if("success"===q.status){var r=[l+"/"+c[0].textContent];c.parent().attr("data-text",c[0].textContent),AnimateNotifiers.success(r)}},function(o,q,r){console.log(o),console.log(q),console.log(r)})}if(9===b&&1===f)if(""===c[0].textContent)c.css("display","none"),c.siblings("button").css("display","inline");else{var n=addSubCategory(d),l=makeid();c.attr("contenteditable","false"),c.siblings("span").css("display","inline"),newcols($(this).parent().attr("data-col")),setTimeout(function(){$("."+n+" .title").css("display","inline-block"),$("."+n+" .title").focus()},1e3);var j=baseUrl+"category_insert/",k={category:c[0].textContent,teacher:c.parent().parent().attr("data-t"),sub:c.parent().parent().attr("data-s"),"class":c.parent().parent().attr("data-c"),exam:c.parent().parent().attr("data-e")},m=[l+"/"+c[0].textContent];AnimateNotifiers.show(m),ajax(j,k,function(o){var q=o.data;if("success"===q.status){var r=[l+"/"+c[0].textContent];AnimateNotifiers.success(r),c.parent().attr("data-id",q.id),c.parent().attr("data-text",c[0].textContent)}},function(o,q,r){console.log(o),console.log(q),console.log(r)})}}function keyDownPressSubCategory(a){var b=a.keyCode||a.which,c=$(this).parent().attr("data-category"),d=$(this).parent().attr("data-col"),f=$(this).parent().attr("data-subcategory"),g=$("."+f+" .subcategory-text"),h=$("."+f+" .porcent"),j=g.attr("data-edit");if(13===b&&"false"===j)return!1;if(13===b&&"true"===j){if(""===g[0].textContent){+$(".main."+c).attr("colspan")-1;f=$(".sub."+f).attr("data-id");var m=g.parent().attr("data-text");return $("#modalDinamicTable").css("display","block"),$("#modalDinamicTable .modal-content").addClass("slideDown"),$("#modalDinamicTable .modal-content .message-title").text("Eliminaci\xF3n de subcategoria"),$("#modalDinamicTable .modal-content .message").text("Desea eliminar la subcategoria ").append("<b>"+m+"?</b>"),objDelete.el=d,objDelete.id=f,objDelete.text=m,objDelete.tipo="subcategory",objDelete.parentCategory=c,objDelete.url="subcategory_delete",!1}var n=baseUrl+"subcategory_update/",o={subcategory_id:g.parent().attr("data-id"),subcategory:g[0].textContent},q=makeid(),r=[q+"/"+g[0].textContent];AnimateNotifiers.show(r),ajax(n,o,function(v){var w=v.data;if("success"===w.status){var x=[q+"/"+g[0].textContent];AnimateNotifiers.success(x),g.parent().attr("data-text",g[0].textContent)}},function(v,w,x){console.log(v),console.log(w),console.log(x)}),g.attr("contenteditable","false")}if(9===b&&"false"===j)if(""===g[0].textContent){var s=$(".main."+c+"+ td").attr("data-category");g.siblings("button").css("display","inline-block"),""===$(".main."+s+" .box-category")[0].textContent&&($(".main."+s+" .btnAdd").css("display","none"),$(".main."+s+" .title.subcategory-text").css("display","inline-block").attr("contenteditable","true"),setTimeout(function(){$(".main."+s+" .title.subcategory-text").focus()},1e3))}else{$("#dinamicTable tr td.col-"+d+" .box-nota").html("-").css("display","inline-block"),$("#dinamicTable tr td.col-"+d+".col-subadd").removeClass("col-subadd"),h.css("display","inline-block");var t=newColSubCategory(c,d),u=incrementVal($(".main."+c).attr("colspan"));$(".main."+c).attr("colspan",u);var n=baseUrl+"subcategory_insert/",o={category_id:$(".main."+c).attr("data-id"),subject_id:g.parent().parent().attr("data-s"),subcategory:g[0].textContent},q=makeid(),r=[q+"/"+g[0].textContent];AnimateNotifiers.show(r),ajax(n,o,function(v){var w=v.data;if("success"===w.status){var x=[q+"/"+g[0].textContent];AnimateNotifiers.success(x),g.parent().attr("data-id",w.id),g.attr({contenteditable:"false","data-edit":"true"}),g.parent().attr("data-text",g[0].textContent)}},function(v,w,x){console.log(v),console.log(w),console.log(x)})}}function keyDownPressPointsCategory(a){var b=a.keyCode||a.which,c=$(this);if(13===b&&100<+c[0].textContent)return!1;if(13===b&&""!==c[0].textContent){var f=c.parent().parent().attr("data-category"),g={id:c.parent().parent().attr("data-id"),points:c[0].textContent},h=makeid(),j=[h+"/"+c.parent().siblings("span")[0].textContent+" ("+c[0].textContent+")"];AnimateNotifiers.show(j),ajax(baseUrl+"points_category_insert/",g,function(k){var l=k.data;if("success"===l.status){var m=[h+"/"+c.parent().siblings("span")[0].textContent+" ("+c[0].textContent+")"];AnimateNotifiers.success(m),validatePointsTotalCategories(),validatePointsSubcategories(f)}},function(k,l,m){console.log(k),console.log(l),console.log(m)}),c.attr("contenteditable","false")}}function keyDownPressPointsSubCategory(a){var b=a.keyCode||a.which,c=$(this),d=$(this).parent().parent().attr("data-category"),f=$(this).parent().parent().attr("data-col"),g=+$(".main."+d+" .points-category")[0].textContent;if(13===b&&+c[0].textContent>g||13===b&&0==+c[0].textContent&&0==g)return!1;if(13===b&&""!==c[0].textContent){var j={id:c.parent().parent().attr("data-id"),points:c[0].textContent},k=makeid(),l=[k+"/"+c.parent().siblings("span")[0].textContent+" ("+c[0].textContent+")"];AnimateNotifiers.show(l),ajax(baseUrl+"points_subcategory_insert/",j,function(m){var n=m.data;if("success"===n.status){var o=[k+"/"+c.parent().siblings("span")[0].textContent+" ("+c[0].textContent+")"];if(AnimateNotifiers.success(o),""==n.update&&(validatePointsSubcategories(c.parent().parent().attr("data-category")),validatePointsTotalSubcategories()),""!==n.update){var q=n.update;for(var r in q){var s=makeid(),t=$("#dinamicTable tr[data-num='"+q[r].student+"'] td").eq(1).text(),u=(+q[r].nota).toFixed(2);AnimateNotifiers.show([s+"/"+t+" ("+u+")"]),o=[s+"/"+t+" ("+u+")"],AnimateNotifiers.success(o),$("#dinamicTable tr[data-num='"+q[r].student+"'] .col-"+f+":not('.sub') .box-nota").text(u),validatePointsSubcategories($("#dinamicTable .col-"+f+".sub").attr("data-category")),calcTotalsNotasStudent(q[r].student)}validatePointsTotalSubcategories(),totalNotasAllSubcategories(),studentSuccess()}}},function(m,n,o){console.log(m),console.log(n),console.log(o)}),c.attr("contenteditable","false")}}function porcentToPoints(a,b){return a*b/100}function calcTotalNota(a,b){var c=+$("tr[data-num='"+a+"'] .total-student").text();$("tr[data-num='"+a+"'] .total-student").text((c+ +b).toFixed(2))}function calcTotalsNotasStudent(a){var b=0;$("#dinamicTable tr[data-num='"+a+"']").each(function(){$(this).find("td .box-nota").each(function(){"-"!=$(this)[0].textContent&&""!=$(this)[0].textContent&&(b+=+$(this).text())})}),$("tr[data-num='"+a+"'] .total-student").text(b.toFixed(2))}function calcTotalsNotasAllStudents(){$(".total-student").text(0),$("#dinamicTable tr").each(function(){$(this).find("td .box-nota").each(function(){"-"!=$(this)[0].textContent&&""!=$(this)[0].textContent&&calcTotalNota($(this).parent().parent()[0].attributes[4].nodeValue,$(this).text())})})}function studentSuccess(){$("#dinamicTable tr[data-num]").each(function(){var b=$(this).attr("data-num"),c=+$(this).attr("data-mn");$(this).find("td").last().each(function(){var d=+$(this).find(".total-student").text(),f=+$(this).find(".total-student-subcategories").text();$(this).css({background:"inherit",color:"inherit"}),100==f&&(d>=c?$(this).css({background:"rgba(153, 191, 45, 0.72)",color:"rgb(255, 255, 255)"}):$(this).css({background:"rgb(241, 93, 93,0.72)",color:"rgb(255, 255, 255)"}))})})}function totalNotasSubcategoryStudents(a,b){var c=$("#dinamicTable td[data-subcategory='"+a+"']:not('.sub')").length,d=+$(".sub."+a+" .points-subcategory").text(),f=0;if($("#dinamicTable td[data-subcategory='"+a+"']:not('.sub')").each(function(){$(this).find(".box-nota").each(function(){"-"!=$(this)[0].textContent&&""!=$(this)[0].textContent&&f++})}),c==f){var g=+$(".total-student-subcategories").eq(0).text();b=g+d,0<d&&$(".total-student-subcategories").text(b.toFixed(2))}}function totalNotasAllSubcategories(){$(".total-student-subcategories").text(0);$("#dinamicTable tr").eq(1).each(function(){$(this).find("td.sub:not('.col-subadd')").each(function(){$(this).attr("data-text")!==void 0&&totalNotasSubcategoryStudents($(this).attr("data-subcategory"),0)})})}function keyDownPressPoints(a){var b=a.keyCode||a.which,c=$(this),d=c.parent().attr("data-edit"),f=c.parent().attr("data-col"),g=c.parent().attr("data-subcategory"),h=$(".sub."+g).attr("data-category"),j=c.parent().parent().children()[1].textContent,k=+$(".sub."+g+" .points-subcategory")[0].textContent,l=c[0].textContent;if(0<c[0].textContent.indexOf("p")){var m=c[0].textContent.indexOf("p"),n=c[0].textContent.substring(0,+m);l=porcentToPoints(k,+n)}if(0<c[0].textContent.indexOf("%")){var m=c[0].textContent.indexOf("%"),n=c[0].textContent.substring(0,+m);l=porcentToPoints(k,+n)}if(13===b&&l>k||13===b&&""==l||13===b&&""==l&&""==k||13===b&&0==l&&0==k||9===b&&l>k||9===b&&""==l||9===b&&""==l&&""==k||9===b&&0==l&&0==k)return"false"===d&&c.text("-").attr("contenteditable","false"),!1;if(13===b&&""!==c[0].textContent||9===b&&""!==c[0].textContent){var o=+$(".main."+h).attr("data-id"),q=+$(".sub."+g).attr("data-id"),r=+c.parent().parent().attr("data-num"),s=+c.parent().parent().attr("data-e"),t=+c.parent().parent().attr("data-s"),u=+c.parent().parent().attr("data-c"),v=+c.parent().parent().attr("data-st");if("false"===d){var w=baseUrl+"nota_insert/",x={category:o,subcategory:q,student:r,exam:s,subject:t,"class":u,section:v,nota:l},y=makeid(),z=[y+"/"+j+" ("+l+")"];AnimateNotifiers.show(z),ajax(w,x,function(B){var C=B.data;if("success"===C.status){var D=[y+"/("+l+")"];if(AnimateNotifiers.success(D),c.text(l),c.parent().attr({"data-edit":"true","data-id":C.id}),calcTotalsNotasStudent(c.parent().parent()[0].attributes[4].nodeValue),totalNotasAllSubcategories(),studentSuccess(),9===b&&1===c.parent().parent().next().length){var E=$(".sub."+g).attr("data-col");c.parent().parent().next().find(".col-"+E+" .box-nota").attr("contenteditable","true").text("").focus()}}},function(B,C,D){console.log(B),console.log(C),console.log(D)}),c.attr("contenteditable","false")}if("true"===d){var A=c.parent().attr("data-id"),w=baseUrl+"nota_update/",x={id:A,nota:l},y=makeid(),z=[y+"/"+j+" ("+l+")"];AnimateNotifiers.show(z),ajax(w,x,function(B){var C=B.data;if("success"===C.status){var D=[y+"/("+l+")"];if(AnimateNotifiers.success(D),c.text(l),calcTotalsNotasStudent(c.parent().parent()[0].attributes[4].nodeValue),totalNotasAllSubcategories(),studentSuccess(),9===b&&1===c.parent().parent().next().length){var E=$(".sub."+g).attr("data-col");c.parent().parent().next().find(".col-"+E+" .box-nota").attr("contenteditable","true").text("").focus()}}},function(B,C,D){console.log(B),console.log(C),console.log(D)}),c.attr("contenteditable","false")}}}function incrementVal(a){return+a+1}function editable(){$(this)[0].classList.contains("box-nota")&&"-"===$(this)[0].textContent&&($(this)[0].textContent=""),$(this).attr("contenteditable","true"),$(this).focus()}function focusOut(){""===$(this)[0].textContent&&($(this).css("display","none"),$(this).siblings("button").css("display","inline-block"))}function showSubCategory(){var a=$(this).parent().attr("data-subcategory"),b=$("."+a+" .title.subcategory-text");console.log("."+a+" .title.subcategory-text"),$(this).css("display","none"),b.css("display","inline-block").attr("contenteditable","true"),setTimeout(function(){b.focus()},1e3)}function newcols(a){var a=makeid(),b=makeid();$("#dinamicTable tr td.col-add").each(function(g){0===g?$("<td class='col-add main category-"+a+"' data-col=\""+a+"\" data-category=\"category-"+a+"\" colspan=\"1\">\n                          <span class='box-category title focus-out editable subcategory-text' style='display:none' contenteditable='true'></span>\n                          <span class='porcent' style='display:none' contenteditable='false'>(<b class=\"editable validate-points points-category\">0.00</b>)</span>\n                          <button class='btnAdd' style='display:inline-block'>+</button>\n                        </td>").insertAfter($(this)):1===g?$("<td class='col-"+a+" content-subcategory sub col-add category-"+a+"' data-col=\""+a+"\" data-category=\"category-"+a+"\"></td>").insertAfter($(this)):$("<td class='col-add col-"+a+" category-"+a+"' data-col=\""+a+"\" data-category=\"category-"+a+"\" data-edit=\"false\" colspan=\"1\">\n                <span class=\"box-nota editable\" style='display:none' contenteditable='false'></span>\n              </td>").insertAfter($(this)),$(this).removeClass("col-add")}),withDinamicTable()}function addSubCategory(a){var b=makeid(),c=$(".main."+a).attr("data-col"),d="subcategory-"+b;return $("."+a+".content-subcategory").html("<span class='box-subcategory title editable focus-out subcategory-text' style='display:inline-block' contenteditable='true' data-edit=\"false\"></span>\n                       <span class='porcent' style='display:none' contenteditable='false'>(<b class=\"editable validate-points points-subcategory\">0.00</b>)</span>\n                       <button class='btnAddSubItems' style='display:none'>+</button>").removeClass("content-subcategory"),$(".col-"+c).attr("data-subcategory",d).attr("data-colcategory",c).addClass(d),withDinamicTable(),d}function newColSubCategory(a,b){var c=makeid(),d=$(".main."+a).attr("data-col");return $("#dinamicTable tr td.col-"+b).each(function(h){0===h?$("<td class=\"col-"+c+" "+a+" sub col-subadd subcategory-"+c+"\" data-category='"+a+"' data-subcategory=\"subcategory-"+c+"\" data-col='"+c+"' data-colcategory='"+d+"'>\n                          <span class='box-subcategory title editable focus-out subcategory-text' style='display:inline-block' contenteditable='true' data-edit=\"false\"></span>\n                          <span class='porcent' style='display:none' contenteditable='false'>(<b class=\"editable validate-points points-subcategory\">0.00</b>)</span>\n                          <button class='btnAddSubItems' style='display:none'>+</button>\n                        </td>").insertAfter(this):$("<td class='col-"+c+" "+a+" col-subadd' data-category='"+a+"' data-subcategory=\"subcategory-"+c+"\" data-col='"+c+"' data-colcategory='"+d+"' data-edit='false'>\n                <span class=\"box-nota editable\" style='display:none' contenteditable='false'></span>\n              </td>").insertAfter(this)}),withDinamicTable(),c}function keypressValidate(a){var b=a.keyCode||a.which;if(!(45<b&&59>b))return!1}function keypressValidateNotas(a){var b=a.keyCode||a.which;if(!(45<b&&59>b)&&190!==b&&112!==b&&37!==b)return!1}function validatePointsSubcategories(a){var b=$("."+a+" .points-category"),c=+b.text(),d=0;$(".sub:not('.col-subadd')."+a+" .points-subcategory").each(function(){d+=+$(this).text()}),d===c?b.removeClass("has-warning"):b.addClass("has-warning")}function validatePointsTotalCategories(){var c=0<arguments.length&&arguments[0]!==void 0&&arguments[0],a=$("#totalCategory"),b=0;$(".main:not('.col-add') .points-category").each(function(){b+=+$(this)[0].textContent,c&&validatePointsSubcategories($(this).parent().parent().attr("data-category"))}),100===b?(a.removeClass("has-warning"),a.text(b.toFixed(2))):(a.addClass("has-warning"),a.text(b.toFixed(2)))}function validatePointsTotalSubcategories(){var c=0<arguments.length&&arguments[0]!==void 0&&arguments[0],a=$("#totalSubcategory"),b=0;$(".sub:not('.col-subadd') .points-subcategory").each(function(){b+=+$(this)[0].textContent}),100===b?(a.removeClass("has-warning"),a.text(b.toFixed(2))):(a.addClass("has-warning"),a.text(b.toFixed(2)))}function deleteItem(){var a=baseUrl+objDelete.url,b={item:objDelete.id};ajax(a,b,function(c){var d=c.data;if("success"===d.status&&($("#modalDinamicTable .modal-content").removeClass("slideDown").addClass("slideDownOut"),"category"===objDelete.tipo&&setTimeout(function(){$("#modalDinamicTable").css("display","none"),$("."+objDelete.el).remove(),validatePointsTotalCategories(),validatePointsTotalSubcategories(),calcTotalsNotasAllStudents(),totalNotasAllSubcategories(),studentSuccess(),withDinamicTable(),$("#modalDinamicTable .modal-content").removeClass("slideDownOut")},1200),"subcategory"===objDelete.tipo)){var f=+$(".main."+objDelete.parentCategory).attr("colspan")-1;setTimeout(function(){$("#modalDinamicTable").css("display","none"),$(".col-"+objDelete.el).remove(),$(".main."+objDelete.parentCategory).attr("colspan",f),validatePointsSubcategories(objDelete.parentCategory),validatePointsTotalSubcategories(),calcTotalsNotasAllStudents(),totalNotasAllSubcategories(),studentSuccess(),withDinamicTable(),$("#modalDinamicTable .modal-content").removeClass("slideDownOut")},1200)}},function(c,d,f){console.log(c),console.log(d),console.log(f)})}function cancelItemDelete(){$("#modalDinamicTable .modal-content").removeClass("slideDown").addClass("slideDownOut"),"category"===objDelete.tipo&&($("."+objDelete.el+" .box-category").text(objDelete.text).css("display","inline-block").attr("contenteditable","false"),$("."+objDelete.el+" .btnAdd").css("display","none"),setTimeout(function(){$("#modalDinamicTable").css("display","none"),$("#modalDinamicTable .modal-content").removeClass("slideDownOut")},1200)),"subcategory"===objDelete.tipo&&($(".col-"+objDelete.el+" .box-subcategory").text(objDelete.text).css("display","inline-block").attr("contenteditable","false"),$(".col-"+objDelete.el+" .btnAddSubItems").css("display","none"),setTimeout(function(){$("#modalDinamicTable").css("display","none"),$("#modalDinamicTable .modal-content").removeClass("slideDownOut")},1200))}$(document).ready(main),$("#dinamicTable").on("click",".btnAdd",addCategory),$("#dinamicTable").on("click",".btnAddSubItems",showSubCategory),$("#dinamicTable").on("click",".editable",editable),$("#dinamicTable").on("keypress",".validate-points",keypressValidate),$("#dinamicTable").on("keypress",".box-nota",keypressValidateNotas),$("#dinamicTable").on("keydown",".box-category",keyDownPressCategory),$("#dinamicTable").on("keydown",".box-subcategory",keyDownPressSubCategory),$("#dinamicTable").on("keydown",".points-category",keyDownPressPointsCategory),$("#dinamicTable").on("keydown",".points-subcategory",keyDownPressPointsSubCategory),$("#dinamicTable").on("keydown",".box-nota",keyDownPressPoints),$("#dinamicTable").on("focusout",".focus-out",focusOut),$("body").on("click","#delete",deleteItem),$("body").on("click",".close-modal",cancelItemDelete);var wrapper1=document.getElementById("wrapper1"),wrapper2=document.getElementById("wrapper2"),url=window.location.pathname,protocol=window.location.protocol,host=window.location.host,splitUrl=url.split("/"),baseUrl=protocol+"//"+host+"/"+splitUrl[1]+"/"+splitUrl[2]+"/",objDelete={el:null,id:null,text:null,url:null,tipo:null},AnimateNotifiers=new animateNotifiers("box-notifier");wrapper1.onscroll=function(){wrapper2.scrollLeft=wrapper1.scrollLeft},wrapper2.onscroll=function(){wrapper1.scrollLeft=wrapper2.scrollLeft},withDinamicTable(),validatePointsTotalCategories(!0),validatePointsTotalSubcategories(),totalNotasAllSubcategories(),calcTotalsNotasAllStudents(),studentSuccess();